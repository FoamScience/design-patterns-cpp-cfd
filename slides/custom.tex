\section{How do I send my own data?}

\begin{frame}[fragile]{A graph to hold neighboring processors}

Say we have something like this:

\begin{CodeEnvNoComment}[A directed graph of nodes]{cpp}{\scriptsize}
struct Edge {
    label destination = -1;
    scalar weight = 0.0;
};
using Graph = List<List<Edge>>;
// Try to push an edge from master to all procs
Edge ej;
if (Pstream::master())
{
    ej.destination = 16;
    ej.weight = 5.2;
}
\end{CodeEnvNoComment}

{\scriptsize Note: Edge does not have the requirements to be in a List yet}

\end{frame}

\begin{frame}[fragile]{A graph to hold neighboring processors}
First, does this compile?

\begin{CodeEnv}[Push an edge from master to All]{cpp}{\tiny \raggedright \alert{\bf error:} No match for {\tt operator<<(OPstream\&,Edge\&)}\\ \alert{\bf error:} No match for {\tt operator>>(IPstream\&,Edge\&)}}{\scriptsize}
Pstream::scatter(ej);
\end{CodeEnv}

So, Edges can't be communicated as MPI messages, fix it:
\begin{CodeEnvNoComment}[Stream Operators for Edge class]{cpp}{\scriptsize}
Ostream&  operator<<(Ostream& os, Edge& e) {
    os << e.destination << " " << e.weight;
    return os;
}
Istream&  operator>>(Istream& is, Edge& e) {
    is >> e.destination;
    is >> e.weight;
    return is;
}
\end{CodeEnvNoComment}
\end{frame}

\begin{frame}[fragile]{A graph to hold neighboring processors}
Try again:

\begin{CodeEnv}[Gathering info about graph nodes]{cpp}{\tiny Compiles, and works as expected}{\scriptsize}
Pstream::gatherList(g);
Pstream::scatterList(g);

// Check graph edges on all processes
Pout << g << endl;
\end{CodeEnv}


A Better way: Make Edge a child of one of the OpenFOAM classes
\begin{CodeEnvNoComment}[Better ways to define an Edge]{cpp}{\scriptsize}
struct Edge : public Tuple2<label, scalar> {};
// That's it, Edge is now fully MPI-ready
\end{CodeEnvNoComment}

\end{frame}
